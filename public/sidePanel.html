<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Curtin Deadlines</title>
    <!-- sidePanel.css is injected by MiniCssExtractPlugin via sidePanel.ts -->
    <link rel="stylesheet" href="sidePanel.css" />
  </head>
  <body>
    <div class="app">
      <!-- ‚îÄ‚îÄ Header ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <header class="header">
        <div class="header-row">
          <div class="title-group">
            <!-- Calendar emoji as lightweight logo -->
            <span class="logo-icon">üìã</span>
            <span class="title">Curtin Deadlines</span>
          </div>
          <div class="header-actions">
            <!-- Export deadlines to an ICS calendar file -->
            <button
              id="export-btn"
              class="icon-btn"
              title="Export to .ics calendar"
            >
              <!-- Calendar download icon (inline SVG) -->
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
                <polyline points="8 17 12 21 16 17"></polyline>
                <line x1="12" y1="12" x2="12" y2="21"></line>
              </svg>
            </button>
            <!-- Toggle light / dark mode -->
            <button id="theme-toggle" class="icon-btn" title="Toggle dark mode">
              üåô
            </button>
            <!-- Open settings panel -->
            <button id="settings-btn" class="icon-btn" title="Settings">
              <!-- Gear / cog icon (inline SVG) -->
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="12" cy="12" r="3"></circle>
                <path
                  d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"
                ></path>
              </svg>
            </button>
          </div>
        </div>
        <p class="subtitle">All your deadlines in one place</p>
      </header>

      <!-- ‚îÄ‚îÄ Main section (PDF drop + manual form + deadline list) ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <main id="main-section">
        <!-- ‚îÄ‚îÄ Outline API fetch section ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <!-- Lets the user skip PDF upload by fetching outline data directly
             from the publicly accessible OutSystems API -->
        <div id="api-section">
          <input
            id="api-unit-code"
            type="text"
            placeholder="Unit code, e.g. COMP1005"
            maxlength="10"
            autocomplete="off"
            spellcheck="false"
          />
          <div class="api-row">
            <select id="api-semester">
              <option value="1">Semester 1</option>
              <option value="2">Semester 2</option>
            </select>
            <input
              id="api-year"
              type="number"
              value="2026"
              min="2024"
              max="2030"
            />
            <button id="api-fetch-btn">Fetch outline</button>
          </div>
          <!-- Status / error message shown during and after fetch -->
          <p id="api-status"></p>
        </div>

        <!-- PDF upload / drag-drop zone -->
        <div
          id="drop-zone"
          class="drop-zone"
          role="button"
          tabindex="0"
          aria-label="Drop unit outline PDF or timetable here"
        >
          <div class="drop-zone-inner">
            <span class="drop-icon">üìÑ</span>
            <span class="drop-primary"
              >Drop unit outline PDF or timetable here</span
            >
            <span class="drop-sub">or click to browse ¬∑ PDF or .ics</span>
            <!-- Shown when PDFs are staged; hidden when queue is empty -->
            <span id="queue-badge" class="queue-badge hidden"></span>
          </div>
          <!-- Hidden file input ‚Äî accepts PDF and .ics (.ics routed to ICS handler in JS) -->
          <input
            type="file"
            id="file-input"
            accept=".pdf,.ics"
            multiple
            hidden
          />
        </div>

        <!-- Scan button ‚Äî appears below the drop zone when PDFs are staged -->
        <button id="file-queue-scan" class="button hidden">
          Scan <span id="file-queue-count"></span>
        </button>

        <!-- Parsing progress (hidden until PDF is loading) -->
        <div id="parse-progress" class="parse-progress hidden">
          <div class="parse-spinner"></div>
          <span id="parse-status">Reading PDF‚Ä¶</span>
        </div>

        <!-- ‚îÄ‚îÄ Manual add form (collapsed by default) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <details id="manual-details" class="manual-section">
          <summary class="manual-toggle">
            <span>+ Add deadline manually</span>
          </summary>
          <form id="manual-form" class="manual-form" autocomplete="off">
            <!-- Unit code + task name (always visible) -->
            <div class="form-row">
              <div class="form-field">
                <label for="f-unit">Unit code</label>
                <input
                  type="text"
                  id="f-unit"
                  placeholder="e.g. COMP1005"
                  maxlength="8"
                />
              </div>
              <div class="form-field" style="flex: 2">
                <label for="f-title">Task name</label>
                <input
                  type="text"
                  id="f-title"
                  placeholder="e.g. Assignment 1"
                />
              </div>
            </div>

            <!-- Mode toggle: by week or by exact date -->
            <div class="mode-toggle-row">
              <label class="mode-option">
                <input type="radio" name="add-mode" value="week" checked />
                <span>By week</span>
              </label>
              <label class="mode-option">
                <input type="radio" name="add-mode" value="date" />
                <span>By date</span>
              </label>
            </div>

            <!-- ‚îÄ‚îÄ Week mode fields ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
            <div id="week-fields" class="mode-fields">
              <div class="form-row">
                <div class="form-field">
                  <label for="f-semester">Semester</label>
                  <select id="f-semester">
                    <option value="1">Semester 1</option>
                    <option value="2">Semester 2</option>
                  </select>
                </div>
                <div class="form-field">
                  <label for="f-year">Year</label>
                  <input
                    type="number"
                    id="f-year"
                    min="2024"
                    max="2030"
                    value="2026"
                  />
                </div>
                <div class="form-field">
                  <label for="f-week">Week</label>
                  <input
                    type="text"
                    id="f-week"
                    placeholder="e.g. 5 or 5-7"
                    maxlength="5"
                  />
                </div>
              </div>
              <!-- Show computed date preview (updated live) -->
              <div id="week-preview" class="date-preview hidden"></div>
            </div>

            <!-- ‚îÄ‚îÄ Exact date mode fields ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
            <div id="date-fields" class="mode-fields hidden">
              <div class="form-row">
                <div class="form-field" style="flex: 2">
                  <label for="f-date">Date</label>
                  <input type="date" id="f-date" />
                </div>
                <div class="form-field">
                  <label for="f-time">Time (optional)</label>
                  <input type="time" id="f-time" />
                </div>
              </div>
            </div>

            <div id="form-error" class="form-error hidden"></div>

            <button type="submit" class="button">Add deadline</button>
          </form>
        </details>

        <!-- ‚îÄ‚îÄ Deadline list ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <section id="deadline-list-section">
          <!-- Filter + sort bar ‚Äî hidden until at least one deadline exists -->
          <div id="filter-bar" class="filter-bar hidden">
            <!-- Unit code dropdown ‚Äî options populated dynamically by JS -->
            <select
              id="filter-unit"
              class="filter-unit-sel"
              title="Filter by unit"
            >
              <option value="">All units</option>
            </select>
            <!-- Status filter pills -->
            <div
              class="filter-pills"
              role="group"
              aria-label="Filter by status"
            >
              <button class="filter-pill active" data-status="all">All</button>
              <button class="filter-pill" data-status="upcoming">
                Upcoming
              </button>
              <button class="filter-pill" data-status="tba">TBA</button>
              <button class="filter-pill" data-status="overdue">Overdue</button>
            </div>
            <!-- Sort toggle button ‚Äî cycles Date ‚Üï / Unit ‚Üï -->
            <button
              id="sort-btn"
              class="filter-sort-btn"
              title="Toggle sort order"
            >
              Date ‚Üï
            </button>
          </div>

          <div id="deadline-list">
            <!-- Deadline cards rendered by sidePanel.ts -->
          </div>

          <!-- Shown when deadlines exist but none match the current filter -->
          <div id="filter-empty" class="filter-empty hidden">
            <p>No deadlines match this filter.</p>
          </div>

          <!-- Empty state ‚Äî shown when there are no deadlines at all -->
          <div id="empty-state" class="empty-state hidden">
            <span class="empty-icon">‚úÖ</span>
            <p>No deadlines yet.</p>
            <p class="empty-sub">
              Drop a unit outline PDF above, or add one manually.
            </p>
          </div>
        </section>
      </main>

      <!-- ‚îÄ‚îÄ Confirmation section (PDF review, hidden by default) ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <section id="confirmation-section" class="hidden">
        <div class="confirm-header">
          <button id="confirm-back" class="text-btn">‚Üê Back</button>
          <h2 class="confirm-title">Review extracted deadlines</h2>
          <span id="confirm-source" class="confirm-source"></span>
        </div>
        <!-- Hint for editing rows before importing -->
        <p class="confirm-hint">
          Edit unit codes and task names as needed. Uncheck items to skip them.
          TBA items are unchecked by default.
        </p>
        <!-- Extracted deadline rows rendered by JS -->
        <div id="confirm-list"></div>
        <!-- No-results message (shown if parser found nothing) -->
        <div id="confirm-empty" class="confirm-empty hidden">
          <p>Couldn't extract any deadlines from this PDF.</p>
          <p class="confirm-empty-sub">
            The PDF may not contain a text layer (scanned image) or uses a
            different format.<br />
            Please add deadlines manually using the form above.
          </p>
        </div>
        <div class="confirm-footer">
          <button id="confirm-add" class="button">Add selected</button>
        </div>
      </section>

      <!-- ‚îÄ‚îÄ Settings section (hidden by default) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <section id="settings-section" class="hidden">
        <div class="confirm-header">
          <button id="settings-back" class="text-btn">‚Üê Back</button>
          <span class="confirm-title">Settings</span>
        </div>

        <!-- Preferences group: default semester + overdue position -->
        <div class="settings-group">
          <h3 class="settings-heading">Preferences</h3>
          <label class="form-field">
            Default semester
            <select id="set-semester">
              <option value="1">Semester 1</option>
              <option value="2">Semester 2</option>
            </select>
          </label>
          <div class="form-field">
            Overdue items position
            <div class="radio-row">
              <label
                ><input
                  type="radio"
                  name="overdue-pos"
                  value="bottom"
                  checked
                />
                Bottom</label
              >
              <label
                ><input type="radio" name="overdue-pos" value="top" />
                Top</label
              >
            </div>
          </div>
        </div>

        <!-- Data management group: JSON export / import / clear -->
        <div class="settings-group">
          <h3 class="settings-heading">Data</h3>
          <div class="settings-row">
            <button id="set-export-json" class="button button--secondary">
              Export JSON
            </button>
            <button id="set-import-json-btn" class="button button--secondary">
              Import JSON
            </button>
            <!-- Hidden file input triggered by Import JSON button -->
            <input
              id="set-import-json-file"
              type="file"
              accept=".json"
              hidden
            />
          </div>
          <button id="set-clear-all" class="button button--danger">
            Clear all deadlines
          </button>
          <!-- Inline delete confirmation ‚Äî revealed when Clear is clicked -->
          <p id="set-clear-confirm" class="hidden settings-danger-row">
            Delete all deadlines?
            <button id="set-clear-yes" class="button button--danger button--sm">
              Delete
            </button>
            <button
              id="set-clear-no"
              class="button button--secondary button--sm"
            >
              Cancel
            </button>
          </p>
        </div>

        <!-- Other group: reset the "Did you submit?" prompt -->
        <div class="settings-group">
          <h3 class="settings-heading">Other</h3>
          <button id="set-reset-prompt" class="button button--secondary">
            Reset "Did you submit?" prompt
          </button>
          <p id="set-reset-msg" class="settings-hint hidden">
            Prompt will show again next time.
          </p>
        </div>

        <!-- Developer tools: open the test panel in a new tab -->
        <div class="settings-group">
          <h3 class="settings-heading">Developer</h3>
          <button id="set-open-test-panel" class="button button--secondary">
            Open Test Panel
          </button>
          <p class="settings-hint">
            Scan unit outlines, validate parser output, detect drift, and
            download reports.
          </p>
        </div>
      </section>

      <!-- ‚îÄ‚îÄ ICS import section (hidden by default) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
      <section id="ics-section" class="hidden">
        <div class="confirm-header">
          <button id="ics-back" class="text-btn">‚Üê Back</button>
          <span class="confirm-title">Import timetable</span>
        </div>

        <!-- Sub-section A: unit codes detected in the timetable .ics.
             Shown only when the file contains recognisable Curtin unit codes. -->
        <div id="ics-units-section" class="hidden">
          <!-- Heading text set by JS, e.g. "3 units detected ‚Äî fetch their deadlines" -->
          <p id="ics-units-heading" class="settings-heading"></p>
          <!-- One checkbox row per unit code, rendered by JS -->
          <div id="ics-units-list"></div>
          <button id="ics-fetch-btn" class="button">
            Fetch deadlines for selected units
          </button>
        </div>

        <!-- Divider shown only when both sub-sections have content -->
        <hr id="ics-divider" class="ics-divider hidden" />

        <!-- Sub-section B: TBA deadlines matched to exam events in the .ics.
             Shown only when at least one TBA deadline has a matching event. -->
        <div id="ics-exams-section" class="hidden">
          <!-- Summary line, e.g. "2 exam dates matched" -->
          <p id="ics-hint" class="settings-heading"></p>
          <!-- One checkbox row per matched TBA deadline, rendered by JS -->
          <div id="ics-list"></div>
          <button id="ics-apply" class="button">
            Apply selected exam dates
          </button>
        </div>
      </section>

      <!-- Toast notification container ‚Äî populated dynamically by toast.ts -->
      <div id="toast-container"></div>
    </div>
    <!-- /.app -->

    <!-- Main side panel script (compiled from sidePanel.ts) -->
    <script src="sidePanel.js"></script>
  </body>
</html>
